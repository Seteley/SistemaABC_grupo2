SELECT
    a.codigo AS cod_actividad,
    a.cod_centro,
    ia.cod_inductor,
    ia.porcentaje,
    SUM(rp.monto) FILTER (WHERE r.cod_prorrateo = ia.cod_inductor) OVER (PARTITION BY a.cod_centro) AS suma_prorrateo_centro,
    (ia.porcentaje / 100.0) * SUM(rp.monto) FILTER (WHERE r.cod_prorrateo = ia.cod_inductor) OVER (PARTITION BY a.cod_centro) AS costo_actividad
FROM
    actividad a
JOIN
    inductor_actividad ia ON ia.cod_actividad = a.codigo
JOIN
    recurso r ON r.cod_prorrateo = ia.cod_inductor
JOIN
    recurso_periodo rp ON rp.cod_recurso = r.codigo AND rp.fecha_periodo = ia.fecha_periodo
WHERE
    ia.fecha_periodo = '2024-12-01'
GROUP BY
    a.codigo,
    a.cod_centro,
    ia.cod_inductor,
    ia.porcentaje,
    rp.monto,
    r.cod_prorrateo
ORDER BY
    a.cod_centro,
    a.codigo;
